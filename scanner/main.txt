#include <stdio.h>
#include <stdlib.h>

FILE *pont1, *pont2;

int acha_tipo (char prox){
    if((prox>64)&&(prox<91))
        return 0;
    if((prox>96)&&(prox<123))
        return 0;
    if((prox>47)&&(prox<58))
        return 1;
    return 2;
}

void afd(){
    int estado = 1, tipo, novoestado,i;
    int erro = 0,conta;
    char prox, palavra[9];
    int T[3][3] = {{2,0,0},{2,2,3},{3,0,0}};
    int avance[3][3] = {{1,0,0},{1,1,0},{0,0,0}};
    int aceita[3] = {0,0,1};
    char reservadas[2][9]={"if","else"};

    while((prox = getc(pont1))!=EOF){
	 conta=0;
        if((tipo=acha_tipo(prox))!=0){
printf("\nchar: %c, tipo: %d\n",prox,tipo);
            erro = 1;
            fputc(prox,pont2);
        }
        while(!aceita[estado] && !erro){
	    palavra[conta]=prox;
	    conta++;
            novoestado=T[estado][tipo];
            if(avance[estado][tipo]){
                prox=fgetc(pont1);
                tipo=acha_tipo(prox);

printf("\nchar: %c, tipo: %d\n",prox,tipo);
            erro = 1;
            }
            estado=novoestado;
	}
            if(conta<=9){
	    	for(i=0;i<2;i++){
			if(palavra==reservadas[i]){
				fputs(palavra,pont2);
				break;
			}
		}
	    }       
	    if (aceita[estado] && i==2)
	    fputc('I',pont2);
 	    fputc('D',pont2);
            fputc(prox,pont2);
    }
}

int main(){

    if((pont1=fopen("sort.txt","r"))==NULL)
        printf("Erro na abertura do arquivo.\n");
    else
        printf("Arquivo aberto com sucesso.\n");

    if((pont2=fopen("id.txt","w"))==NULL)
        printf("Erro na abertura do arquivo.\n");
    else
        printf("Arquivo aberto com sucesso.\n");

    afd();

    fclose(pont1);
    fclose(pont2);
    return 0;
}
